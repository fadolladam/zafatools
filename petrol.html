<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petrol Tax Invoice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styles for printing */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                background-color: white;
                padding: 0;
                margin: 0;
            }
            .no-print {
                display: none !important;
            }
            .invoice-card {
                box-shadow: none;
                border: 1px solid #e5e7eb;
                margin: 0;
                width: 100%;
                max-width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8 flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full">
        <!-- Action Buttons -->
        <div class="flex justify-center gap-4 mb-8 no-print">
            <button id="reset-btn" class="px-6 py-2 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75 transition-colors">
                Reset
            </button>
            <button id="download-btn" class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 transition-colors">
                Download as Image
            </button>
             <button onclick="window.print()" class="px-6 py-2 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 transition-colors">
                Print
            </button>
        </div>

        <!-- Master Invoice Card 1 (Editable) -->
        <div id="invoice-1" class="invoice-card bg-white p-6 rounded-lg border border-gray-200 shadow-lg">
            <!-- Header -->
            <header class="flex justify-between items-center pb-4 border-b">
                <div class="flex items-center gap-4">
                   <img src="https://tela.com.kh/wp-content/uploads/2023/01/New_Tela-logo-02-Big.png" alt="Tela Logo" class="h-16" onerror="this.onerror=null; this.src='https://placehold.co/200x78/e2e8f0/334155?text=Logo';">
                </div>
                <div class="text-right">
                    <p class="font-semibold">Phone:</p>
                    <input type="text" value="023 885 551" class="text-gray-600 p-1 border-b w-full text-right focus:outline-none focus:border-blue-500">
                </div>
            </header>
            
            <h2 class="text-center text-xl font-bold text-gray-600 my-4">Tax Invoice</h2>

            <!-- Details Section -->
            <div class="grid grid-cols-2 gap-6 text-sm">
                <div>
                    <p class="font-semibold text-gray-700">Bill To:</p>
                    <input type="text" id="billTo" value="Customer" class="mt-1 p-1 border-b w-full focus:outline-none focus:border-blue-500">
                </div>
                <div class="text-right">
                    <p class="font-semibold text-gray-700">Invoice Details:</p>
                    <div class="grid grid-cols-2 gap-x-2 gap-y-1 mt-1 text-left">
                        <span class="font-medium">No:</span> <input type="text" id="invNo" value="103123" class="p-1 border-b w-full focus:outline-none focus:border-blue-500" readonly>
                        <span class="font-medium">Date:</span> <input type="text" id="invDate" placeholder="" class="p-1 border-b w-full focus:outline-none focus:border-blue-500">
                        <span class="font-medium">Time:</span> <input type="text" id="invTime" placeholder="" class="p-1 border-b w-full focus:outline-none focus:border-blue-500">
                    </div>
                </div>
            </div>

            <!-- Items Table -->
            <div class="mt-6">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="p-2 font-semibold">Item</th>
                            <th class="p-2 font-semibold text-center">Qty</th>
                            <th class="p-2 font-semibold text-center">Unit</th>
                            <th class="p-2 font-semibold text-right">Price/Unit($)</th>
                            <th class="p-2 font-semibold text-right">Amount($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="p-2">Petrol</td>
                            <td class="p-2"><input type="number" id="quantity" value="10" class="w-16 text-center p-1 border-b focus:outline-none focus:border-blue-500"></td>
                            <td class="p-2 text-center">Ltr</td>
                            <td class="p-2 text-right"><input type="number" id="price" value="1.15" step="0.01" class="w-24 text-right p-1 border-b focus:outline-none focus:border-blue-500"></td>
                            <td id="amount" class="p-2 text-right font-medium">11.50</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Summary Section -->
            <div class="mt-6 flex justify-end">
                <div class="w-64 text-sm">
                    <div class="flex justify-between py-1">
                        <span class="font-semibold text-gray-700">Sub Total:</span>
                        <span id="subTotal" class="font-medium">$ 11.50</span>
                    </div>
                    <div class="flex justify-between py-2 border-t-2 border-dashed mt-2">
                        <span class="font-bold text-base text-gray-800">Grand Total:</span>
                        <span id="grandTotal" class="font-bold text-base text-gray-800">$ 11.50</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DOM Element References ---
            const quantityInput = document.getElementById('quantity');
            const priceInput = document.getElementById('price');
            const billToInput = document.getElementById('billTo');
            const invNoInput = document.getElementById('invNo');
            const invDateInput = document.getElementById('invDate');
            const invTimeInput = document.getElementById('invTime');

            const amountCell = document.getElementById('amount');
            const subTotalCell = document.getElementById('subTotal');
            const grandTotalCell = document.getElementById('grandTotal');

            const resetButton = document.getElementById('reset-btn');
            const downloadButton = document.getElementById('download-btn');
            
            const invoiceCard = document.getElementById('invoice-1');

            const defaultValues = {
                quantity: '10',
                price: '1.15',
                billTo: 'Customer',
            };

            // --- Helper Functions ---
            function generateInvoiceNumber() {
                // Generates a random 3-digit number and prepends it with 103
                const randomPart = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `103${randomPart}`;
            }

            // --- Core Calculation Function ---
            function calculateTotal() {
                const quantity = parseFloat(quantityInput.value) || 0;
                const price = parseFloat(priceInput.value) || 0;

                const totalAmount = quantity * price;

                // Format numbers for US currency
                const formatCurrency = (num) => num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                amountCell.textContent = formatCurrency(totalAmount);
                subTotalCell.textContent = `$ ${formatCurrency(totalAmount)}`;
                grandTotalCell.textContent = `$ ${formatCurrency(totalAmount)}`;
            }

            // --- Event Listeners ---
            quantityInput.addEventListener('input', calculateTotal);
            priceInput.addEventListener('input', calculateTotal);

            resetButton.addEventListener('click', () => {
                quantityInput.value = defaultValues.quantity;
                priceInput.value = defaultValues.price;
                billToInput.value = defaultValues.billTo;
                
                // Clear invoice details for manual input
                invDateInput.value = '';
                invTimeInput.value = '';
                invVehicleInput.value = '';
                
                invNoInput.value = generateInvoiceNumber();
                
                calculateTotal();
            });

            downloadButton.addEventListener('click', () => {
                invoiceCard.classList.add('border-transparent');
                invoiceCard.classList.remove('border-gray-200');

                html2canvas(invoiceCard, { scale: 2 }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `invoice-${invNoInput.value}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    invoiceCard.classList.remove('border-transparent');
                    invoiceCard.classList.add('border-gray-200');
                });
            });

            // --- Initial Setup ---
            function initialize() {
                invNoInput.value = generateInvoiceNumber();
                 // Clear fields for manual input on initial load
                invDateInput.value = '';
                invTimeInput.value = '';
                invVehicleInput.value = '';
                calculateTotal();
            }

            initialize();
        });
    </script>
</body>
</html>
