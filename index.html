<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monochrome Tools - Unified Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Library for QR Code & 2FA -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/otpauth@9.2.2/dist/otpauth.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>body{font-family:'Inter',sans-serif}.page-content{display:none}.page-content.active{display:block}.nav-btn,.qr-tab-btn,.fb-sub-tab-btn{display:flex;align-items:center;width:100%;padding:.75rem 1rem;border-radius:.375rem;transition:background-color .2s,color .2s;cursor:pointer}.nav-btn.active,.nav-btn:hover{background-color:#374151}.qr-tab-btn,.fb-sub-tab-btn{background-color:#e5e7eb;color:#374151;justify-content:center;flex-grow:1;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:.5rem 1rem;font-size:.875rem}.dark .qr-tab-btn,.dark .fb-sub-tab-btn{background-color:#374151;color:#d1d5db}.qr-tab-btn.active,.fb-sub-tab-btn.active{background-color:#3b82f6;color:white}.dark .qr-tab-btn.active,.dark .fb-sub-tab-btn.active{background-color:#3b82f6}.qr-tab-content,.fb-sub-tab-content{display:none}.qr-tab-content.active,.fb-sub-tab-content.active{display:block}.nav-btn svg{margin-right:.75rem;flex-shrink:0}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:#1f2937}::-webkit-scrollbar-thumb{background:#4b5563;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#6b7280}.fb-page-card{transition:transform .2s,box-shadow .2s}.fb-page-card:hover{transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,0,0,0.1)}.fb-page-card.selected{box-shadow:0 0 0 3px #3b82f6;transform:translateY(-2px)}.calendar-day-today{background-color:#fef9c3 !important}.dark .calendar-day-today{background-color:#4338ca !important}#two-fa-progress-bar{transition:width .5s linear}
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex h-screen antialiased">

  <!-- Sidebar -->
  <aside class="w-64 bg-gray-800 text-white flex-shrink-0 flex flex-col p-4 space-y-2 overflow-y-auto">
    <div class="text-2xl font-bold mb-4 text-center">üì¶ MyTools</div>

    <div class="space-y-1">
        <div class="text-sm uppercase text-gray-400 mt-4 px-2">Primary Tools</div>
        <button data-page="home" class="nav-btn active"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>Home</button>
        <button data-page="image-download" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>Image Downloader</button>
        <button data-page="upload-imgbb" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>Upload to ImgBB</button>
        <button data-page="image-tools" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg>Image Tools</button>
        <button data-page="calendar" class="nav-btn">üìÖ Hijri Calendar</button>
    </div>
    
    <div class="space-y-1">
        <div class="text-sm uppercase text-gray-400 mt-4 px-2">Generators</div>
        <button data-page="qr-generator" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>QR Code Generator</button>
        <button data-page="2fa-generator" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>2FA Generator</button>
    </div>

    <div class="space-y-1">
        <div class="text-sm uppercase text-gray-400 mt-4 px-2">Facebook Suite</div>
        <button data-page="fb-publisher" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Publisher</button>
        <button data-page="fb-power-editor" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"></path></svg>Power Editor</button>
        <button data-page="fb-pages" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>Pages</button>
        <button data-page="fb-bm" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>Business Manager</button>
        <button data-page="fb-ads" class="nav-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Ads Manager</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 lg:p-8 overflow-y-auto bg-gray-200 dark:bg-gray-900">
    <div id="mainContent">
      
      <!-- Home Page -->
      <div id="page-home" class="page-content active"><h1 class="text-3xl font-bold mb-6 text-gray-800 dark:text-white">Dashboard</h1><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><button data-page="fb-publisher" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-blue-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">Facebook Publisher</div></button><button data-page="fb-power-editor" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-purple-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">Power Editor</div></button><button data-page="fb-ads" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-red-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">Ads Manager</div></button><button data-page="qr-generator" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-sky-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">QR Code Generator</div></button><button data-page="2fa-generator" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-teal-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">2FA Generator</div></button><button data-page="image-download" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-green-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">Image Downloader</div></button><button data-page="upload-imgbb" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-indigo-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">Upload to ImgBB</div></button><button data-page="image-tools" class="dashboard-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-transform duration-200"><div class="flex items-center justify-center mb-3 text-purple-500"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg></div><div class="text-lg font-semibold text-center text-gray-800 dark:text-white">Image Tools</div></button></div></div>

       <!-- QR Code Generator Page -->
      <div id="page-qr-generator" class="page-content">
        <div class="w-full">
            <h1 class="text-3xl font-bold mb-4 text-gray-800 dark:text-white">Advanced QR Code Generator</h1>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                <!-- Left Panel: Input -->
                <div class="lg:col-span-3 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                    <div class="flex flex-wrap border-b border-gray-300 dark:border-gray-600 mb-4">
                        <button data-qr-tab="url" class="qr-tab-btn active">üîó URL/Text</button>
                        <button data-qr-tab="vcard" class="qr-tab-btn">üë§ VCard</button>
                        <button data-qr-tab="email" class="qr-tab-btn">‚úâÔ∏è Email</button>
                        <button data-qr-tab="sms" class="qr-tab-btn">üí¨ SMS</button>
                    </div>
                    <div class="qr-tab-content active" id="qr-tab-content-url"><label class="block text-sm font-medium">URL or Text</label><textarea id="qr-text" rows="4" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="https://example.com"></textarea></div>
                    <div class="qr-tab-content" id="qr-tab-content-vcard"><div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto pr-2"><div><label class="block text-sm font-medium">First Name</label><input type="text" id="qr-vcard-fn" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">Last Name</label><input type="text" id="qr-vcard-ln" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div class="md:col-span-2"><label class="block text-sm font-medium">Organization</label><input type="text" id="qr-vcard-org" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div class="md:col-span-2"><label class="block text-sm font-medium">Position</label><input type="text" id="qr-vcard-title" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">Phone (Work)</label><input type="tel" id="qr-vcard-tel-work" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">Phone (Private)</label><input type="tel" id="qr-vcard-tel-private" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">Email</label><input type="email" id="qr-vcard-email" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">Website</label><input type="url" id="qr-vcard-url" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div class="md:col-span-2"><label class="block text-sm font-medium">Street</label><input type="text" id="qr-vcard-street" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">City</label><input type="text" id="qr-vcard-city" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div><label class="block text-sm font-medium">Zip Code</label><input type="text" id="qr-vcard-zip" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div><div class="md:col-span-2"><label class="block text-sm font-medium">Country</label><input type="text" id="qr-vcard-country" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></div></div></div>
                    <div class="qr-tab-content" id="qr-tab-content-email"><label class="block text-sm font-medium">Email Address</label><input type="email" id="qr-email-to" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="recipient@example.com"><label class="block text-sm font-medium mt-4">Subject</label><input type="text" id="qr-email-subject" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Email Subject"><label class="block text-sm font-medium mt-4">Message</label><textarea id="qr-email-body" rows="3" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></textarea></div>
                    <div class="qr-tab-content" id="qr-tab-content-sms"><label class="block text-sm font-medium">Phone Number</label><input type="tel" id="qr-sms-phone" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="15551234567"><label class="block text-sm font-medium mt-4">Message</label><textarea id="qr-sms-message" rows="3" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"></textarea></div>

                    <div class="border-t dark:border-gray-700 mt-4 pt-4 space-y-4">
                        <div><label class="block text-sm font-medium">QR Code Name (for saving)</label><input type="text" id="qr-name" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="My Business Card"></div>
                        <div><label class="block text-sm font-medium">Content Category (optional)</label><select id="qr-category" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md"><option>Marketing</option><option>Personal</option><option>Business</option><option>Event</option></select></div>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-6"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><h3 class="font-semibold mb-3 text-lg">Customize</h3><div class="grid grid-cols-2 gap-4"><div><label for="qr-color-dark" class="block text-sm font-medium">Color</label><input type="color" id="qr-color-dark" value="#000000" class="w-full h-10 border-none rounded-md cursor-pointer"></div><div><label for="qr-color-light" class="block text-sm font-medium">Background</label><input type="color" id="qr-color-light" value="#ffffff" class="w-full h-10 border-none rounded-md cursor-pointer"></div></div><div class="mt-4"><label for="qr-logo-url" class="block text-sm font-medium">Logo URL (optional)</label><input type="url" id="qr-logo-url" class="w-full border p-2 mt-1 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="https://.../logo.png"></div></div><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md text-center"><h3 class="font-semibold mb-3 text-lg">Preview</h3><div id="qr-code-container" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg flex items-center justify-center min-h-[200px]"><canvas id="qr-canvas" class="hidden"></canvas><span id="qr-placeholder" class="text-gray-500">Awaiting input...</span></div><button id="btn-generate-qr" class="mt-4 w-full bg-sky-600 text-white px-4 py-3 rounded-md hover:bg-sky-700 font-semibold">Generate & Update QR</button><a id="btn-download-qr" href="#" download="qrcode.png" class="mt-2 w-full inline-block bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 opacity-50 pointer-events-none">Download PNG</a></div></div>
            </div>
        </div>
      </div>
      
       <!-- 2FA Generator Page -->
       <div id="page-2fa-generator" class="page-content">
        <div class="max-w-md mx-auto">
            <h1 class="text-3xl font-bold mb-4 text-gray-800 dark:text-white">2FA Code Generator</h1>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <label for="two-fa-secret" class="block text-sm font-medium">Secret Key</label>
                <input type="text" id="two-fa-secret" class="w-full mt-1 border p-2 bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Enter your 2FA secret key">
                
                <div class="my-6 text-center">
                    <div id="two-fa-code" class="text-5xl font-bold tracking-widest text-blue-500">------</div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4 dark:bg-gray-700">
                      <div id="two-fa-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 100%"></div>
                    </div>
                </div>
                <div id="two-fa-error" class="text-red-500 text-sm text-center"></div>
            </div>
        </div>
      </div>
      
      <!-- Image Download Page -->
      <div id="page-image-download" class="page-content"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><h1 class="text-2xl font-bold mb-4">Image Downloader</h1><textarea id="imageUrls" class="w-full h-40 border p-2 mb-4 bg-gray-50 dark:bg-gray-700 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter image URLs here (one per line)..."></textarea><div class="space-x-2 mb-4"><button id="btn-preview" class="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600">Preview</button><button id="btn-download" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Download All</button></div><div id="preview" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4"></div></div></div>

      <!-- Upload to ImgBB Page -->
      <div id="page-upload-imgbb" class="page-content"><div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6"><h1 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center gap-2"><svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>Upload to ImgBB</h1><label for="uploadInput" class="block w-full cursor-pointer border-dashed border-2 border-gray-300 dark:border-gray-600 p-6 text-center text-gray-600 dark:text-gray-400 rounded-lg hover:border-indigo-500 hover:text-indigo-500 transition-colors">üìÅ Click or drag and drop images<input type="file" id="uploadInput" accept="image/*" multiple hidden /></label><div id="previewArea" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-6"></div><button id="btn-upload-imgbb" class="mt-6 w-full bg-indigo-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center justify-center gap-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"></path></svg>Upload Images</button><div id="uploadStatus" class="mt-4 text-sm text-center text-gray-600 dark:text-gray-400"></div><ul id="uploadedUrls" class="mt-6 space-y-4"></ul></div></div>

      <!-- Image Tools Page -->
      <div id="page-image-tools" class="page-content"><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><section class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><h3 class="text-xl font-semibold mb-4">Image Resizer</h3><input type="file" id="resizerInput" multiple accept="image/*" class="mb-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"><div class="flex gap-4 mb-4"><input type="number" id="resizerWidth" placeholder="Width (px)" class="w-full border p-2 rounded bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500"><input type="number" id="resizerHeight" placeholder="Height (px)" class="w-full border p-2 rounded bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500"></div><div class="flex gap-2"><button id="btn-resize" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex-grow">Resize</button><button id="btn-download-resized" class="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600">Download All</button></div><div id="resizerOutput" class="mt-6 grid grid-cols-2 gap-4"></div></section><section class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><h3 class="text-xl font-semibold mb-4">Image Compressor</h3><input type="file" id="compressorInput" multiple accept="image/*" class="mb-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"><label class="block text-sm font-medium mb-2">Quality (0.1 to 1.0)</label><input type="number" id="compressorQuality" step="0.1" value="0.7" min="0.1" max="1.0" class="w-full border p-2 rounded mb-4 bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-green-500"><div class="flex gap-2"><button id="btn-compress" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex-grow">Compress</button><button id="btn-download-compressed" class="ml-2 bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600">Download All</button></div><div id="compressorOutput" class="mt-6 grid grid-cols-2 gap-4"></div></section></div></div>

      <!-- Facebook Publisher Page -->
      <div id="page-fb-publisher" class="page-content"><div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-6"><div class="flex flex-wrap items-center gap-4"><label for="fb-token-input-publisher" class="font-semibold">Facebook Access Token:</label><input type="password" id="fb-token-input-publisher" class="flex-grow p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Paste your token here..."><button id="fb-token-submit-publisher" class="bg-blue-600 text-white px-5 py-2 rounded-md font-semibold hover:bg-blue-700">Fetch Data</button></div></div><div class="flex space-x-1 mb-[-1px]"><button data-fb-sub-tab="photo" class="fb-sub-tab-btn active">üì∑ Photo Post</button><button data-fb-sub-tab="video" class="fb-sub-tab-btn">üé¨ Video / Reels</button></div><div class="bg-white dark:bg-gray-800 p-6 rounded-b-lg rounded-r-lg shadow-md"><div id="fb-sub-tab-photo" class="fb-sub-tab-content active"><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="space-y-6"><div><h3 class="font-semibold text-lg mb-2">1. Select Pages</h3><div id="fb-page-selection-grid" class="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-60 overflow-y-auto p-2 bg-gray-50 dark:bg-gray-900 rounded"><span class="text-gray-500 col-span-full text-center p-4">Please submit a token.</span></div></div><div><h3 class="font-semibold text-lg mb-2">2. Compose Post</h3><textarea id="fb-post-message" rows="5" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="What's on your mind?"></textarea><div class="mt-4"><label class="block text-sm font-medium">Image Source</label><div class="flex mt-1"><button id="img-src-upload" class="px-4 py-2 bg-blue-500 text-white rounded-l-md">Upload</button><button id="img-src-url" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-r-md">URL</button></div></div><label id="fb-media-upload-label" class="mt-2 block w-full cursor-pointer bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-center p-4 rounded-md">üñºÔ∏è Upload Images from Computer<input type="file" id="fb-media-upload" accept="image/*" multiple hidden></label><textarea id="fb-media-urls" rows="3" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md mt-2 hidden" placeholder="Enter one image URL per line..."></textarea></div><button id="fb-publish-button" class="w-full bg-green-600 text-white px-5 py-3 rounded-md font-bold text-lg hover:bg-green-700 disabled:bg-gray-400" disabled>Publish to Selected Pages</button></div><div><h3 class="font-semibold text-lg mb-2">3. Live Preview</h3><div class="w-full max-w-lg mx-auto bg-white dark:bg-gray-700 rounded-lg shadow-lg p-4 border border-gray-200 dark:border-gray-600"><div class="flex items-center mb-3"><img id="fb-preview-avatar" src="https://placehold.co/40x40/cbd5e1/475569?text=P" class="w-10 h-10 rounded-full mr-3 bg-gray-200"><div><div id="fb-preview-name" class="font-bold">Page Name</div><div class="text-xs text-gray-500 dark:text-gray-400">Just now ¬∑ üåé</div></div></div><div id="fb-preview-message" class="mb-3 whitespace-pre-wrap"></div><div id="fb-preview-media" class="grid grid-cols-2 gap-1 rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-600 min-h-[100px]"></div></div><div id="fb-publish-status" class="mt-4 text-sm space-y-2"></div></div></div></div><div id="fb-sub-tab-video" class="fb-sub-tab-content"><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div><h3 class="font-semibold text-lg mb-2">1. Select Page</h3><select id="fb-video-page-selector" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md"><option>Submit token first</option></select><h3 class="font-semibold text-lg mt-6 mb-2">2. Upload Video</h3><label class="mt-2 block w-full cursor-pointer bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-center p-4 rounded-md">üé¨ Upload Video from Computer<input type="file" id="fb-video-upload" accept="video/*" hidden></label><textarea id="fb-video-description" rows="4" class="w-full mt-4 p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Video description..."></textarea><div class="flex items-center mt-4"><input type="checkbox" id="fb-post-as-reel" class="h-4 w-4"><label for="fb-post-as-reel" class="ml-2">Post as Reel</label></div><button id="fb-publish-video-button" class="w-full mt-4 bg-green-600 text-white px-5 py-3 rounded-md font-bold text-lg hover:bg-green-700 disabled:bg-gray-400" disabled>Publish Video</button><div id="fb-video-publish-status" class="mt-4 text-sm"></div></div><div><h3 class="font-semibold text-lg mb-2">Video Preview</h3><video id="fb-video-preview" class="w-full rounded-lg bg-black" controls></video></div></div></div></div></div>
      
      <!-- Facebook Pages Page -->
      <div id="page-fb-pages" class="page-content"><h1 class="text-3xl font-bold mb-4">Facebook Page Posts</h1><div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-6"><label for="fb-page-post-selector" class="block text-sm font-medium mb-1">Select a Page to view its posts</label><select id="fb-page-post-selector" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md"><option>Submit token in Publisher first</option></select></div><div id="fb-posts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><p class="text-gray-500 col-span-full text-center p-8">No Page selected.</p></div></div>

      <!-- Facebook Business Manager Page -->
      <div id="page-fb-bm" class="page-content"><h1 class="text-3xl font-bold mb-4">Business Manager Overview</h1><div id="fb-bm-container" class="space-y-4"><p class="text-gray-500 text-center p-8">Submit token in Publisher first to see Business Managers.</p></div></div>

      <!-- Facebook Ads Manager Page -->
      <div id="page-fb-ads" class="page-content"><h1 class="text-3xl font-bold mb-4">Ads Manager</h1><div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-6"><label for="fb-ad-account-selector" class="block text-sm font-medium mb-1">Select an Ad Account to view campaigns</label><select id="fb-ad-account-selector" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md"><option>Submit token in Publisher first</option></select></div><div id="fb-campaigns-container" class="bg-white dark:bg-gray-800 p-1 rounded-lg shadow-md overflow-x-auto"><p class="text-gray-500 text-center p-8">No Ad Account selected.</p></div></div>

      <!-- Facebook Power Editor Page -->
      <div id="page-fb-power-editor" class="page-content"><h1 class="text-3xl font-bold mb-4">Power Editor: Instant Experience</h1><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md"><h3 class="font-semibold text-lg mb-2">1. Select Page & Post Message</h3><select id="fb-canvas-page-selector" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md"><option>Submit token in Publisher first</option></select><textarea id="fb-canvas-message" rows="3" class="w-full mt-4 p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Message for the post that opens the Instant Experience..."></textarea><h3 class="font-semibold text-lg mt-4 mb-2">2. Build Canvas Elements</h3><div id="fb-canvas-elements-container" class="space-y-4 max-h-96 overflow-y-auto p-2 border-t border-b"></div><button id="fb-add-canvas-element" class="mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Add Element</button><button id="fb-publish-canvas" class="mt-4 w-full bg-green-600 text-white px-5 py-3 rounded-md font-bold text-lg hover:bg-green-700 disabled:bg-gray-400" disabled>Publish Instant Experience</button></div><div><h3 class="font-semibold text-lg mb-2">3. Preview (Conceptual)</h3><div id="fb-canvas-preview" class="p-4 bg-gray-200 dark:bg-gray-900 rounded-lg min-h-[400px]"></div><div id="fb-canvas-publish-status" class="mt-4 text-sm"></div></div></div></div>
      
      <!-- Facebook Unified Inbox Page -->
      <div id="page-fb-inbox" class="page-content"><h1 class="text-3xl font-bold mb-4">Unified Inbox</h1><div class="bg-blue-100 dark:bg-blue-900/30 border-l-4 border-blue-500 text-blue-700 dark:text-blue-300 p-4 rounded-md mb-6" role="alert"><p class="font-bold">Feature Notice</p><p>A fully functional real-time inbox requires a backend server and special permissions from Facebook. This page serves as a UI concept and is not connected to live data.</p></div><div class="h-[75vh] flex bg-white dark:bg-gray-800 rounded-lg shadow-md"><div class="w-1/3 border-r dark:border-gray-700 flex flex-col"><div class="p-4 border-b dark:border-gray-600 font-bold">Conversations</div><div class="flex-grow overflow-y-auto"><div class="p-4 border-b dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"><div><strong>John Doe</strong><span class="text-xs text-gray-500 ml-2">2h</span></div><p class="text-sm text-gray-600 dark:text-gray-400 truncate">Hey, is this item still available?</p></div><div class="p-4 border-b dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 bg-blue-50 dark:bg-blue-900/20"><div><strong>Jane Smith</strong><span class="text-xs text-gray-500 ml-2">1d</span></div><p class="text-sm font-semibold truncate">I'd like to place an order.</p></div></div></div><div class="w-2/3 flex flex-col"><div class="p-4 border-b dark:border-gray-600 font-bold">Jane Smith</div><div class="flex-grow p-4 overflow-y-auto space-y-4"><div class="flex justify-start"><div class="bg-gray-200 dark:bg-gray-600 p-3 rounded-lg max-w-md">I'd like to place an order.</div></div><div class="flex justify-end"><div class="bg-blue-500 text-white p-3 rounded-lg max-w-md">Great! What can I get for you?</div></div></div><div class="p-4 border-t dark:border-gray-600"><input class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Type a message..." disabled></div></div></div></div>
      
      <!-- Hijri Calendar Page -->
      <div id="page-calendar" class="page-content">
        <div class="flex gap-6">
            <div class="w-2/3 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <div class="flex items-center justify-between mb-4"><button id="cal-prev" class="text-2xl font-bold">&larr;</button><h2 id="calendar-title" class="text-2xl font-bold">Calendar</h2><button id="cal-next" class="text-2xl font-bold">&rarr;</button></div>
                <div id="calendar-grid-header" class="grid grid-cols-7 gap-2 text-center font-medium text-gray-500"></div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2 mt-2 auto-rows-fr"></div>
            </div>
            <div class="w-1/3 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h3 class="font-bold text-lg mb-4">Events This Month</h3>
                <div id="calendar-event-list" class="space-y-3 max-h-[60vh] overflow-y-auto"></div>
            </div>
        </div>
      </div>
    </div>
  </main>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {

    /*******************************************************************
    * SINGLE PAGE APP ROUTER & CORE LOGIC
    *******************************************************************/
    let activePage = 'home';
    const pages = ['home', 'qr-generator', '2fa-generator', 'image-download', 'upload-imgbb', 'image-tools', 'fb-publisher', 'fb-power-editor', 'fb-inbox', 'fb-pages', 'fb-bm', 'fb-ads', 'calendar'];
    
    const showPage = (pageName) => {
        if (!pages.includes(pageName)) pageName = 'home';
        const currentPageEl = document.getElementById(`page-${activePage}`);
        if(currentPageEl) currentPageEl.classList.remove('active');
        document.querySelector(`.nav-btn[data-page="${activePage}"]`)?.classList.remove('active');
        
        const newPageEl = document.getElementById(`page-${pageName}`);
        if(newPageEl) newPageEl.classList.add('active');
        document.querySelector(`.nav-btn[data-page="${pageName}"]`)?.classList.add('active');
        
        activePage = pageName;
        if(pageName === 'calendar') renderCalendar();
        window.location.hash = pageName;
    };
    
    const initialHash = window.location.hash.substring(1);
    showPage(initialHash || 'home');

    document.querySelectorAll('.nav-btn').forEach(btn => { btn.addEventListener('click', () => showPage(btn.dataset.page)); });
    document.querySelectorAll('.dashboard-card').forEach(card => { card.addEventListener('click', () => showPage(card.dataset.page)); });

    /*******************************************************************
    * CALENDAR LOGIC
    *******************************************************************/
    const islamicHolidays = {"01-01":"Isra' and Mi'raj (Approx.)","03-12":"Start of Ramadan (Approx.)","04-10":"Eid al-Fitr (Approx.)","06-16":"Arafat Day (Approx.)","06-17":"Eid al-Adha (Approx.)","07-07":"Islamic New Year (Approx.)","09-15":"Prophet's Birthday (Approx.)"};
    const khmerHolidays = {"01-01":"International New Year Day","01-07":"Victory Day","03-08":"International Women's Day","04-13":"Khmer New Year Day","04-14":"Khmer New Year Day","04-15":"Khmer New Year Day","04-16":"Khmer New Year Day","05-01":"International Labour Day","05-14":"King Sihamoni's Birthday","05-22":"Visak Bochea Day","05-26":"Royal Ploughing Ceremony","06-18":"Queen Mother's Birthday","09-24":"Constitution Day","10-12":"Pchum Ben Day","10-13":"Pchum Ben Day","10-14":"Pchum Ben Day","10-15":"Commemoration Day of King's Father","10-29":"King's Coronation Day","11-09":"Independence Day","11-25":"Water Festival","11-26":"Water Festival","11-27":"Water Festival"};
    let calCurrentDate = new Date();

    const renderCalendar = () => {
        const year = calCurrentDate.getFullYear();
        const month = calCurrentDate.getMonth();
        const today = new Date();
        const calendarTitle = document.getElementById('calendar-title');
        const calendarGrid = document.getElementById('calendar-grid');
        const eventList = document.getElementById('calendar-event-list');
        if(!calendarTitle) return;

        calendarTitle.textContent = `${calCurrentDate.toLocaleString('default', { month: 'long' })} ${year}`;
        calendarGrid.innerHTML = '';
        eventList.innerHTML = '';

        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const startDay = new Date(year, month, 1).getDay();
        
        const header = document.getElementById('calendar-grid-header');
        if(header.children.length === 0) {
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => header.innerHTML += `<div>${day}</div>`);
        }

        for (let i = 0; i < startDay; i++) { calendarGrid.innerHTML += `<div></div>`; }

        let monthEvents = {};

        for (let day = 1; day <= daysInMonth; day++) {
            const dateKey = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const islamicEvent = islamicHolidays[dateKey];
            const khmerEvent = khmerHolidays[dateKey];
            let eventsOnDay = [];
            if(islamicEvent) eventsOnDay.push({name: islamicEvent, type: 'islamic'});
            if(khmerEvent) eventsOnDay.push({name: khmerEvent, type: 'khmer'});

            if(eventsOnDay.length > 0) monthEvents[day] = eventsOnDay;

            const cell = document.createElement('div');
            let cellClasses = 'p-2 h-24 border dark:border-gray-700 rounded-md flex flex-col';
            if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                 cellClasses += ' calendar-day-today';
            }
            cellClasses += eventsOnDay.length > 0 ? ' bg-blue-50 dark:bg-blue-900/30 cursor-pointer' : ' bg-gray-50 dark:bg-gray-900/50';
            cell.className = cellClasses;

            cell.innerHTML = `<div class="font-semibold">${day}</div>`;
            if(eventsOnDay.length > 0) {
                 cell.innerHTML += `<div class="text-xs mt-1 truncate ${eventsOnDay[0].type === 'islamic' ? 'text-green-500' : 'text-red-500'}">${eventsOnDay[0].name}</div>`;
                 if(eventsOnDay.length > 1) cell.innerHTML += `<div class="text-xs mt-1 text-gray-400">+1 more</div>`;
                 cell.addEventListener('click', () => {
                    document.querySelectorAll('.calendar-day-selected').forEach(el => el.classList.remove('calendar-day-selected', 'ring-2', 'ring-blue-500'));
                    cell.classList.add('calendar-day-selected', 'ring-2', 'ring-blue-500');
                    renderEventList(monthEvents, day);
                 });
            }
            calendarGrid.appendChild(cell);
        }
        renderEventList(monthEvents);
    };
    
    const renderEventList = (events, specificDay = null) => {
        const eventList = document.getElementById('calendar-event-list');
        eventList.innerHTML = '';
        const daysWithEvents = specificDay ? [specificDay] : Object.keys(events).sort((a,b) => a-b);
        if(daysWithEvents.length === 0 && !specificDay) {
            eventList.innerHTML = '<p class="text-gray-500">No holidays this month.</p>';
            return;
        }
        daysWithEvents.forEach(day => {
            events[day].forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `p-3 rounded-md border-l-4 ${event.type === 'islamic' ? 'border-green-500 bg-green-500/10' : 'border-red-500 bg-red-500/10'}`;
                eventDiv.innerHTML = `<p class="font-bold">${event.name}</p><p class="text-sm">${day} ${calCurrentDate.toLocaleString('default', { month: 'long' })}</p>`;
                eventList.appendChild(eventDiv);
            });
        });
    };

    document.getElementById('cal-prev')?.addEventListener('click', () => { calCurrentDate.setMonth(calCurrentDate.getMonth() - 1); renderCalendar(); });
    document.getElementById('cal-next')?.addEventListener('click', () => { calCurrentDate.setMonth(calCurrentDate.getMonth() + 1); renderCalendar(); });


    /*******************************************************************
    * QR & 2FA GENERATOR LOGIC
    *******************************************************************/
    let activeQrTab = 'url';
    document.querySelectorAll('.qr-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.qrTab;
            document.querySelector('.qr-tab-btn.active').classList.remove('active'); btn.classList.add('active');
            document.querySelector('.qr-tab-content.active').classList.remove('active');
            document.getElementById(`qr-tab-content-${tabName}`).classList.add('active');
            activeQrTab = tabName;
        });
    });

    const generateQrCode = () => {
        let textToEncode = '';
        if (activeQrTab === 'url') {
            textToEncode = document.getElementById('qr-text').value;
        } else if (activeQrTab === 'vcard') {
            const vcard = `BEGIN:VCARD\nVERSION:3.0\nN:${document.getElementById('qr-vcard-ln').value};${document.getElementById('qr-vcard-fn').value}\nFN:${document.getElementById('qr-vcard-fn').value} ${document.getElementById('qr-vcard-ln').value}\nORG:${document.getElementById('qr-vcard-org').value}\nTITLE:${document.getElementById('qr-vcard-title').value}\nTEL;TYPE=WORK,VOICE:${document.getElementById('qr-vcard-tel-work').value}\nTEL;TYPE=HOME,VOICE:${document.getElementById('qr-vcard-tel-private').value}\nEMAIL:${document.getElementById('qr-vcard-email').value}\nURL:${document.getElementById('qr-vcard-url').value}\nADR;TYPE=WORK:;;${document.getElementById('qr-vcard-street').value};${document.getElementById('qr-vcard-city').value};;${document.getElementById('qr-vcard-zip').value};${document.getElementById('qr-vcard-country').value}\nEND:VCARD`;
            textToEncode = vcard;
        } else if (activeQrTab === 'email') {
            const to = document.getElementById('qr-email-to').value;
            const subject = encodeURIComponent(document.getElementById('qr-email-subject').value);
            const body = encodeURIComponent(document.getElementById('qr-email-body').value);
            if(to) textToEncode = `mailto:${to}?subject=${subject}&body=${body}`;
        } else if (activeQrTab === 'sms') {
             const phone = document.getElementById('qr-sms-phone').value.replace(/\D/g, '');
             const message = encodeURIComponent(document.getElementById('qr-sms-message').value);
             if(phone) textToEncode = `smsto:${phone}:${message}`;
        }
        
        const qrContainer = document.getElementById('qr-code-container');
        const downloadBtn = document.getElementById('btn-download-qr');
        const canvas = document.getElementById('qr-canvas');
        const placeholder = document.getElementById('qr-placeholder');
        if (!textToEncode) {
            canvas.classList.add('hidden'); placeholder.classList.remove('hidden');
            placeholder.textContent = 'Please enter content to generate a QR code.';
            downloadBtn.classList.add('opacity-50', 'pointer-events-none'); return;
        }
        const options = { width: 256, margin: 2, color: { dark: document.getElementById('qr-color-dark').value, light: document.getElementById('qr-color-light').value }, errorCorrectionLevel: 'H' };
        QRCode.toCanvas(canvas, textToEncode, options, (error) => {
            if (error) { placeholder.textContent = 'Error generating QR Code.'; canvas.classList.add('hidden'); placeholder.classList.remove('hidden'); console.error(error); downloadBtn.classList.add('opacity-50', 'pointer-events-none'); return; }
            const logoUrl = document.getElementById('qr-logo-url').value;
            if (logoUrl) {
                const ctx = canvas.getContext('2d'); const logo = new Image(); logo.crossOrigin = "Anonymous";
                logo.onload = () => {
                    const logoSize = canvas.width * 0.25; const x = (canvas.width - logoSize) / 2; const y = (canvas.height - logoSize) / 2;
                    ctx.fillStyle = document.getElementById('qr-color-light').value;
                    ctx.fillRect(x - 4, y - 4, logoSize + 8, logoSize + 8); 
                    ctx.drawImage(logo, x, y, logoSize, logoSize);
                    downloadBtn.href = canvas.toDataURL();
                };
                logo.onerror = () => alert("Could not load logo. Check URL and CORS policy.");
                logo.src = `${corsProxy}${encodeURIComponent(logoUrl)}`;
            } else { downloadBtn.href = canvas.toDataURL(); }
            placeholder.classList.add('hidden'); canvas.classList.remove('hidden');
            const qrName = document.getElementById('qr-name').value.trim();
            downloadBtn.download = qrName ? `${qrName}.png` : 'qrcode.png';
            downloadBtn.classList.remove('opacity-50', 'pointer-events-none');
        });
    };
    document.getElementById('btn-generate-qr')?.addEventListener('click', generateQrCode);

    let twoFaInterval = null;
    const twoFaCodeEl = document.getElementById('two-fa-code');
    const twoFaProgressEl = document.getElementById('two-fa-progress-bar');
    const twoFaErrorEl = document.getElementById('two-fa-error');

    const handle2faCodeGeneration = () => {
        clearInterval(twoFaInterval);
        const secret = document.getElementById('two-fa-secret').value.trim().replace(/\s/g, '');
        if (secret.length < 8) {
            twoFaCodeEl.textContent = '------';
            twoFaProgressEl.style.width = '100%';
            twoFaErrorEl.textContent = '';
            return;
        }

        try {
            const totp = new otpauth.TOTP({
                issuer: "ACME",
                label: "2FA",
                algorithm: 'SHA1',
                digits: 6,
                period: 30,
                secret: secret
            });

            twoFaErrorEl.textContent = '';
            
            const updateCode = () => {
                try {
                    const token = totp.generate();
                    const timeRemaining = totp.period - (Math.floor(Date.now() / 1000) % totp.period);
                    twoFaCodeEl.textContent = token.match(/.{1,3}/g).join(' ');
                    twoFaProgressEl.style.width = `${(timeRemaining / totp.period) * 100}%`;
                } catch (e) {
                     twoFaCodeEl.textContent = '------';
                     twoFaErrorEl.textContent = 'Invalid secret key.';
                     clearInterval(twoFaInterval);
                }
            };

            updateCode();
            twoFaInterval = setInterval(updateCode, 1000);

        } catch (e) {
            twoFaCodeEl.textContent = '------';
            twoFaProgressEl.style.width = '100%';
            twoFaErrorEl.textContent = 'Invalid secret key. Please check the key and try again.';
            console.error(e);
        }
    };
    document.getElementById('two-fa-secret')?.addEventListener('input', handle2faCodeGeneration);
    
    /*******************************************************************
    * IMAGE DOWNLOADER LOGIC (CORS FIX)
    *******************************************************************/
    const corsProxy = 'https://corsproxy.io/?';
    const previewImages = () => {
        const urls = document.getElementById('imageUrls').value.trim().split('\n').filter(Boolean);
        const container = document.getElementById('preview'); container.innerHTML = 'Loading previews...'; 
        urls.forEach(url => {
            const proxiedUrl = `${corsProxy}${encodeURIComponent(url.trim())}`;
            const imgContainer = document.createElement('div'); imgContainer.className = "bg-white dark:bg-gray-700 p-2 rounded-lg shadow";
            const img = document.createElement('img'); img.src = proxiedUrl;
            img.className = 'w-full h-auto object-cover rounded';
            img.onerror = () => { img.src = 'https://placehold.co/300x200/ef4444/ffffff?text=Failed+to+load'; };
            imgContainer.appendChild(img);
            if (container.innerHTML === 'Loading previews...') container.innerHTML = '';
            container.appendChild(imgContainer);
        });
    };
    const downloadImages = () => {
        const urls = document.getElementById('imageUrls').value.trim().split('\n').filter(Boolean);
        if (urls.length === 0) return alert('Please enter image URLs.');
        urls.forEach((url, i) => {
            const proxiedUrl = `${corsProxy}${encodeURIComponent(url.trim())}`;
            fetch(proxiedUrl).then(res => { if (!res.ok) throw new Error(`Failed to fetch ${url}`); return res.blob(); }).then(blob => {
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                try { const filename = new URL(url).pathname.split('/').pop(); a.download = filename || `image_${i + 1}.jpg`; } catch { a.download = `image_${i + 1}.jpg`; }
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
            }).catch((err) => alert(`Could not download: ${url}.\nError: ${err.message}`));
        });
    };
    document.getElementById('btn-preview')?.addEventListener('click', previewImages);
    document.getElementById('btn-download')?.addEventListener('click', downloadImages);

    /*******************************************************************
    * IMGBB UPLOADER LOGIC
    *******************************************************************/
    const imgbbApiKey = "16af15f2e1dd39bcbf5dfabd64da040a"; 
    const previewSelectedImages = () => {
        const files = document.getElementById("uploadInput").files;
        const preview = document.getElementById("previewArea"); preview.innerHTML = "";
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const div = document.createElement("div"); div.className = "border dark:border-gray-700 p-2 rounded-lg shadow bg-white dark:bg-gray-700 text-center";
                const img = document.createElement("img"); img.src = e.target.result; img.className = "w-full h-32 object-cover rounded mb-2";
                const filename = document.createElement("p"); filename.className = "text-xs text-gray-600 dark:text-gray-400 truncate"; filename.innerText = file.name;
                div.appendChild(img); div.appendChild(filename); preview.appendChild(div);
            };
            reader.readAsDataURL(file);
        });
    };
    const uploadImages = () => {
        const files = document.getElementById("uploadInput").files; const status = document.getElementById("uploadStatus"); const uploadedList = document.getElementById("uploadedUrls");
        if (files.length === 0) return alert("Please select image files first.");
        uploadedList.innerHTML = ""; status.innerText = "Uploading...";
        const uploadPromises = Array.from(files).map(file => {
            const formData = new FormData(); formData.append("image", file);
            return fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, { method: "POST", body: formData }).then(res => res.json()).then(data => ({ success: data.success, file, data: data.data })).catch(err => ({ success: false, file, error: err }));
        });
        Promise.all(uploadPromises).then(results => {
            status.innerText = "Upload complete.";
            results.forEach(result => {
                if (result.success) {
                    const li = document.createElement("li");
                    li.className = "border dark:border-gray-700 bg-white dark:bg-gray-700 p-3 rounded-lg shadow flex gap-4 items-center";
                    li.innerHTML = `<img src="${result.data.thumb.url}" class="w-16 h-16 object-cover rounded border" alt="Uploaded"><div class="flex-1 overflow-hidden"><p class="text-sm font-medium truncate">${result.file.name}</p><input type="text" readonly value="${result.data.url}" class="w-full text-xs bg-gray-100 dark:bg-gray-800 p-1 rounded mt-1 border dark:border-gray-600"><button class="copy-url-btn text-xs text-blue-500 hover:underline mt-1">Copy URL</button></div>`;
                    uploadedList.appendChild(li);
                } else { uploadedList.innerHTML += `<li class="text-red-500 bg-red-500/10 p-2 rounded-md">‚ùå Upload failed for ${result.file.name}</li>`; }
            });
        });
    };
    document.getElementById('uploadInput')?.addEventListener('change', previewSelectedImages);
    document.getElementById('btn-upload-imgbb')?.addEventListener('click', uploadImages);
    document.getElementById('uploadedUrls').addEventListener('click', (e) => {
        if (e.target.classList.contains('copy-url-btn')) { const urlToCopy = e.target.previousElementSibling.value; navigator.clipboard.writeText(urlToCopy).then(() => alert("‚úÖ URL copied to clipboard!")); }
    });

    /*******************************************************************
    * IMAGE TOOLS LOGIC
    *******************************************************************/
    let resizerBlobList = [], compressorBlobList = [];
    const processImages = (type) => {
        const isResizer = type === 'resize';
        const files = document.getElementById(isResizer ? 'resizerInput' : 'compressorInput').files;
        const output = document.getElementById(isResizer ? 'resizerOutput' : 'compressorOutput');
        output.innerHTML = ""; if (isResizer) resizerBlobList = []; else compressorBlobList = [];
        if (files.length === 0) return;
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas'), ctx = canvas.getContext('2d'); let quality = 0.9;
                    if (isResizer) {
                        const w = parseInt(document.getElementById('resizerWidth').value), h = parseInt(document.getElementById('resizerHeight').value);
                        const ratio = img.width / img.height; let fw = img.width, fh = img.height;
                        if (w && h) { fw = w; fh = h; } else if (w) { fw = w; fh = Math.round(w / ratio); } else if (h) { fh = h; fw = Math.round(h * ratio); }
                        canvas.width = fw; canvas.height = fh; ctx.drawImage(img, 0, 0, fw, fh);
                    } else { canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0); quality = parseFloat(document.getElementById('compressorQuality').value); }
                    canvas.toBlob(blob => {
                        const div = document.createElement('div'); div.className = "border dark:border-gray-700 p-2 space-y-1 rounded-md text-xs";
                        const details = isResizer ? `<p><strong>Original:</strong> ${img.width}√ó${img.height}</p><p><strong>Resized:</strong> ${canvas.width}√ó${canvas.height}</p>` : `<p><strong>Original:</strong> ${(file.size/1024).toFixed(1)} KB</p><p><strong>Compressed:</strong> ${(blob.size/1024).toFixed(1)} KB</p>`;
                        div.innerHTML = `<img src="${URL.createObjectURL(blob)}" class="w-full h-auto border dark:border-gray-600 mb-1 rounded" /><div class="p-1">${details}<a href="${URL.createObjectURL(blob)}" download="${file.name}" class="text-blue-500 hover:underline block mt-1">Download</a></div>`;
                        output.appendChild(div);
                        if (isResizer) resizerBlobList.push({ name: file.name, blob }); else compressorBlobList.push({ name: file.name, blob });
                    }, 'image/jpeg', quality);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    };
    const downloadAll = (type) => {
        const list = type === 'resized' ? resizerBlobList : compressorBlobList;
        if (list.length === 0) return alert(`Please ${type} images first.`);
        list.forEach(({ name, blob }) => { const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${type}-${name}`; document.body.appendChild(a); a.click(); document.body.removeChild(a); });
    };
    document.getElementById('btn-resize')?.addEventListener('click', () => processImages('resize'));
    document.getElementById('btn-download-resized')?.addEventListener('click', () => downloadAll('resized'));
    document.getElementById('btn-compress')?.addEventListener('click', () => processImages('compress'));
    document.getElementById('btn-download-compressed')?.addEventListener('click', () => downloadAll('compressed'));
    
    /*******************************************************************
    * FACEBOOK SUITE LOGIC (REFACTORED)
    *******************************************************************/
    let fbData = { token: null, pages: [], businesses: [], adAccounts: [] };

    const fbTokenInput = document.getElementById('fb-token-input-publisher');
    const fbTokenSubmitBtn = document.getElementById('fb-token-submit-publisher');
    
    const fbPageSelectionGrid = document.getElementById('fb-page-selection-grid');
    const fbPostMessage = document.getElementById('fb-post-message');
    const fbMediaUpload = document.getElementById('fb-media-upload');
    const fbMediaUrls = document.getElementById('fb-media-urls');
    const fbPublishButton = document.getElementById('fb-publish-button');
    const fbPublishStatus = document.getElementById('fb-publish-status');
    const fbPreviewAvatar = document.getElementById('fb-preview-avatar');
    const fbPreviewName = document.getElementById('fb-preview-name');
    const fbPreviewMessage = document.getElementById('fb-preview-message');
    const fbPreviewMedia = document.getElementById('fb-preview-media');
    
    const fbBmContainer = document.getElementById('fb-bm-container');
    const fbAdAccountSelector = document.getElementById('fb-ad-account-selector');
    const fbCampaignsContainer = document.getElementById('fb-campaigns-container');
    const fbPagePostSelector = document.getElementById('fb-page-post-selector');
    const fbPostsContainer = document.getElementById('fb-posts-container');
    
    const fbCanvasPageSelector = document.getElementById('fb-canvas-page-selector');
    const fbCanvasElementsContainer = document.getElementById('fb-canvas-elements-container');
    const fbAddCanvasElementBtn = document.getElementById('fb-add-canvas-element');
    const fbPublishCanvasBtn = document.getElementById('fb-publish-canvas');

    // --- Event Listeners ---
    fbTokenSubmitBtn.addEventListener('click', fetchFacebookData);
    fbMediaUpload.addEventListener('change', handleMediaPreview);
    fbPostMessage.addEventListener('input', updateFbPostPreview);
    fbMediaUrls.addEventListener('input', updateFbPostPreview);
    fbPublishButton.addEventListener('click', publishToFacebook);
    fbPagePostSelector.addEventListener('change', (e) => fetchPagePosts(e.target.value));
    fbAdAccountSelector.addEventListener('change', (e) => fetchCampaigns(e.target.value));
    
    document.querySelectorAll('.fb-sub-tab-btn').forEach(btn => btn.addEventListener('click', (e) => {
        document.querySelector('.fb-sub-tab-btn.active').classList.remove('active');
        e.target.classList.add('active');
        document.querySelector('.fb-sub-tab-content.active').classList.remove('active');
        document.getElementById(`fb-sub-tab-${e.target.dataset.fbSubTab}`).classList.add('active');
    }));

    document.getElementById('img-src-upload').addEventListener('click', () => {
        document.getElementById('fb-media-upload-label').classList.remove('hidden');
        document.getElementById('fb-media-urls').classList.add('hidden');
        document.getElementById('img-src-upload').classList.add('bg-blue-500', 'text-white');
        document.getElementById('img-src-url').classList.remove('bg-blue-500', 'text-white');
    });

    document.getElementById('img-src-url').addEventListener('click', () => {
        document.getElementById('fb-media-upload-label').classList.add('hidden');
        document.getElementById('fb-media-urls').classList.remove('hidden');
        document.getElementById('img-src-url').classList.add('bg-blue-500', 'text-white');
        document.getElementById('img-src-upload').classList.remove('bg-blue-500', 'text-white');
    });

    // --- Core API & Data Handling ---
    async function fetchFacebookData() {
        const token = fbTokenInput.value.trim();
        if (!token) return alert('Please enter an access token.');
        
        fbData.token = token;
        fbTokenSubmitBtn.textContent = 'Loading...';
        fbTokenSubmitBtn.disabled = true;

        try {
            const fields = 'accounts{name,access_token,picture{url}},adaccounts{name,account_id},businesses{name,verification_status,owned_pages{id},owned_ad_accounts{id}}';
            const response = await fbApiGet(`me?fields=${fields}`);
            
            fbData.pages = response.accounts?.data || [];
            fbData.businesses = response.businesses?.data || [];
            fbData.adAccounts = response.adaccounts?.data || [];
            
            renderPublisherPageSelection();
            renderPagesViewer();
            renderBusinessManager();
            renderAdsManager();
            renderPowerEditor();

        } catch (error) {
            alert(`Failed to fetch data: ${error.message}`);
        } finally {
             fbTokenSubmitBtn.textContent = 'Fetch Data';
             fbTokenSubmitBtn.disabled = false;
        }
    }

    async function fbApiGet(endpoint) {
        const url = `https://graph.facebook.com/v19.0/${endpoint}${endpoint.includes('?') ? '&' : '?'}access_token=${fbData.token}`;
        const response = await fetch(url);
        const data = await response.json();
        if (data.error) throw new Error(data.error.message);
        return data;
    }
    
    async function fbApiPost(endpoint, options = {}) {
        const { body, token, method = 'POST' } = options;
        const finalToken = token || fbData.token;
        let url = `https://graph.facebook.com/v19.0/${endpoint}`;
        const fetchOptions = { method, body };
        
        let finalBody = body;
        if (body instanceof FormData) {
            body.append('access_token', finalToken);
        } else {
             url += `${endpoint.includes('?') ? '&' : '?'}access_token=${finalToken}`;
             if (body) {
                fetchOptions.body = body;
                fetchOptions.headers = { 'Content-Type': 'application/x-www-form-urlencoded' };
             }
        }

        const response = await fetch(url, fetchOptions);
        const data = await response.json();
        if (data.error) throw new Error(data.error.message);
        return data;
    }

    // --- Publisher Functions ---
    function renderPublisherPageSelection() {
        fbPageSelectionGrid.innerHTML = '';
        if (fbData.pages.length === 0) {
            fbPageSelectionGrid.innerHTML = '<p class="text-gray-500 col-span-full text-center p-4">No pages found.</p>';
            return;
        }
        fbData.pages.forEach(page => {
            const card = document.createElement('div');
            card.className = 'fb-page-card relative cursor-pointer p-2 border dark:border-gray-700 rounded-lg flex items-center gap-2 bg-white dark:bg-gray-800';
            card.innerHTML = `<input type="checkbox" value="${page.id}" data-token="${page.access_token}" class="absolute top-2 left-2 h-4 w-4"><img src="${page.picture.data.url}" class="w-10 h-10 rounded-md ml-6"><span class="text-sm font-medium truncate">${page.name}</span>`;
            card.addEventListener('click', (e) => {
                const checkbox = card.querySelector('input[type="checkbox"]');
                if (e.target !== checkbox) checkbox.checked = !checkbox.checked;
                card.classList.toggle('selected', checkbox.checked);
                updateFbPostPreview();
            });
            fbPageSelectionGrid.appendChild(card);
        });
    }

    function handleMediaPreview() {
        // This function now just triggers the main preview update
        updateFbPostPreview();
    }
    
    function updateFbPostPreview() {
        const selectedPages = getSelectedPages();
        const firstSelected = fbData.pages.find(p => p.id === selectedPages[0]?.id);
        if(firstSelected) {
            fbPreviewAvatar.src = firstSelected.picture.data.url;
            fbPreviewName.textContent = firstSelected.name + (selectedPages.length > 1 ? ` and ${selectedPages.length - 1} others` : '');
        } else {
             fbPreviewAvatar.src = 'https://placehold.co/40x40/cbd5e1/475569?text=P';
             fbPreviewName.textContent = 'Page Name';
        }
        fbPreviewMessage.textContent = fbPostMessage.value;
        fbPreviewMedia.innerHTML = '';
        
        const files = fbMediaUpload.files;
        const urls = fbMediaUrls.value.trim().split('\n').filter(Boolean);

        const imageSources = Array.from(files).map(file => URL.createObjectURL(file)).concat(urls);

        if(imageSources.length > 0) {
            fbPreviewMedia.style.gridTemplateColumns = imageSources.length > 1 ? 'repeat(2, 1fr)' : '1fr';
            imageSources.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.className = 'w-full h-full object-cover';
                fbPreviewMedia.appendChild(img);
            });
        }
        fbPublishButton.disabled = selectedPages.length === 0 || (fbPostMessage.value.trim() === '' && imageSources.length === 0);
    }
    
    function getSelectedPages() {
        return Array.from(fbPageSelectionGrid.querySelectorAll('input:checked')).map(cb => ({ id: cb.value, token: cb.dataset.token }));
    }

    async function publishToFacebook() {
        const pagesToPost = getSelectedPages();
        const message = fbPostMessage.value;
        const files = fbMediaUpload.files;
        const urls = fbMediaUrls.value.trim().split('\n').filter(Boolean);
        fbPublishStatus.innerHTML = '';
        fbPublishButton.disabled = true;

        for (const page of pagesToPost) {
            const statusP = document.createElement('p'); statusP.textContent = `Posting to ${page.id}...`;
            fbPublishStatus.appendChild(statusP);
            try {
                if (files.length === 0 && urls.length === 0) {
                    await fbApiPost(`${page.id}/feed?message=${encodeURIComponent(message)}`, { method: 'POST', token: page.token });
                } else {
                    const photoIds = [];
                    // Handle uploaded files
                    for(const [i, file] of Array.from(files).entries()) {
                         statusP.textContent = `Uploading image ${i + 1}/${files.length} for ${page.id}...`;
                         const formData = new FormData();
                         formData.append('source', file); formData.append('published', 'false');
                         const res = await fbApiPost(`${page.id}/photos`, { body: formData, token: page.token });
                         photoIds.push(res.id);
                    }
                    // Handle URLs
                    for(const [i, url] of urls.entries()) {
                         statusP.textContent = `Processing URL ${i + 1}/${urls.length} for ${page.id}...`;
                         const res = await fbApiPost(`${page.id}/photos?url=${encodeURIComponent(url)}&published=false`, { method: 'POST', token: page.token });
                         photoIds.push(res.id);
                    }
                    
                     statusP.textContent = `Publishing post to ${page.id}...`;
                     const attachedMedia = photoIds.map((id, i) => `attached_media[${i}]={"media_fbid":"${id}"}`).join('&');
                     await fbApiPost(`${page.id}/feed?message=${encodeURIComponent(message)}&${attachedMedia}`, { method: 'POST', token: page.token });
                }
                statusP.textContent = `‚úÖ Successfully posted to ${page.id}.`;
                statusP.className = 'text-green-500';
            } catch(error) {
                statusP.textContent = `‚ùå Error for ${page.id}: ${error.message}`;
                statusP.className = 'text-red-500';
            }
        }
        fbPublishButton.disabled = false;
    }

    // --- Explorer & Manager Functions ---
    function renderPagesViewer() {
        fbPagePostSelector.innerHTML = '<option>Select a Page</option>';
        fbData.pages.forEach(page => {
            fbPagePostSelector.innerHTML += `<option value="${page.id}|${page.access_token}">${page.name}</option>`;
        });
    }

    function renderBusinessManager() {
        fbBmContainer.innerHTML = '';
        if (fbData.businesses.length === 0) {
            fbBmContainer.innerHTML = '<p class="text-gray-500 text-center">No Business Managers found.</p>'; return;
        }
        fbData.businesses.forEach(bm => {
            const statusColor = bm.verification_status === 'verified' ? 'text-green-400' : 'text-yellow-400';
            const card = document.createElement('div');
            card.className = 'p-4 border dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900';
            card.innerHTML = `<h4 class="font-bold">${bm.name}</h4><p class="text-xs text-gray-500">${bm.id}</p><div class="flex justify-between text-sm mt-2"><span class="font-medium">Status: <span class="${statusColor}">${bm.verification_status}</span></span><span>Pages: <strong>${bm.owned_pages?.data.length || 0}</strong></span><span>Ad Accounts: <strong>${bm.owned_ad_accounts?.data.length || 0}</strong></span></div>`;
            fbBmContainer.appendChild(card);
        });
    }
    
    function renderAdsManager() {
        fbAdAccountSelector.innerHTML = '<option>Select an Ad Account</option>';
        fbData.adAccounts.forEach(acc => {
            fbAdAccountSelector.innerHTML += `<option value="${acc.id}">${acc.name} (${acc.id})</option>`;
        });
    }

    async function fetchCampaigns(adAccountId) {
        if (!adAccountId || adAccountId.startsWith('Select')) {
            fbCampaignsContainer.innerHTML = '<p class="text-gray-500 text-center p-8">No Ad Account selected.</p>';
            return;
        }
        fbCampaignsContainer.innerHTML = '<p class="text-gray-500 text-center p-8">Loading campaigns...</p>';
        try {
            const fields = 'name,status,objective,daily_budget,lifetime_budget,insights{spend,reach,impressions,frequency,cpc,cpm,ctr,actions,cost_per_action_type}';
            const response = await fbApiGet(`${adAccountId}/campaigns?fields=${fields}`);
            const campaigns = response.data || [];
            if(campaigns.length === 0) {
                 fbCampaignsContainer.innerHTML = '<p class="text-gray-500 text-center p-8">No campaigns found.</p>'; return;
            }
            let tableHTML = '<table class="w-full text-sm text-left whitespace-nowrap"><thead><tr class="border-b dark:border-gray-600"><th class="p-2">Campaign</th><th class="p-2">Status</th><th class="p-2">Budget</th><th class="p-2">Spent</th><th class="p-2">Reach</th><th class="p-2">Impressions</th><th class="p-2">Frequency</th><th class="p-2">Results</th><th class="p-2">Cost/Result</th><th class="p-2">CPC</th><th class="p-2">CPM</th><th class="p-2">CTR</th></tr></thead><tbody>';
            campaigns.forEach(c => {
                const insights = c.insights?.data[0] || {};
                const budget = c.daily_budget ? `$${(c.daily_budget/100).toFixed(2)}/day` : (c.lifetime_budget ? `$${(c.lifetime_budget/100).toFixed(2)} total` : 'N/A');
                const resultAction = insights.cost_per_action_type ? insights.cost_per_action_type[0] : null;

                tableHTML += `<tr class="border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="p-2 font-semibold">${c.name}<br><span class="font-normal text-xs text-gray-400">${c.objective}</span></td>
                    <td class="p-2"><span class="px-2 py-1 text-xs rounded-full ${c.status === 'ACTIVE' ? 'bg-green-500/20 text-green-400' : 'bg-gray-500/20 text-gray-400'}">${c.status}</span></td>
                    <td class="p-2">${budget}</td>
                    <td class="p-2 font-mono">${insights.spend ? '$'+parseFloat(insights.spend).toFixed(2) : 'N/A'}</td>
                    <td class="p-2 font-mono">${insights.reach || 'N/A'}</td>
                    <td class="p-2 font-mono">${insights.impressions || 'N/A'}</td>
                    <td class="p-2 font-mono">${insights.frequency ? parseFloat(insights.frequency).toFixed(2) : 'N/A'}</td>
                    <td class="p-2">${resultAction ? `${resultAction.action_type.replace(/_/g, ' ')}: ${resultAction.value}` : 'N/A'}</td>
                    <td class="p-2">${resultAction ? '$' + parseFloat(resultAction.cost).toFixed(2) : 'N/A'}</td>
                    <td class="p-2 font-mono">${insights.cpc ? '$'+parseFloat(insights.cpc).toFixed(2) : 'N/A'}</td>
                    <td class="p-2 font-mono">${insights.cpm ? '$'+parseFloat(insights.cpm).toFixed(2) : 'N/A'}</td>
                    <td class="p-2 font-mono">${insights.ctr ? parseFloat(insights.ctr).toFixed(2) + '%' : 'N/A'}</td>
                </tr>`;
            });
            tableHTML += '</tbody></table>';
            fbCampaignsContainer.innerHTML = tableHTML;
        } catch (error) {
            fbCampaignsContainer.innerHTML = `<p class="text-red-500 text-center p-8">Error: ${error.message}</p>`;
        }
    }
    
    async function fetchPagePosts(pageData) {
        if(!pageData || pageData.startsWith('Select')) {
            fbPostsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center p-8">No Page selected.</p>';
            return;
        }
        const [pageId, pageToken] = pageData.split('|');
        fbPostsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center p-8">Loading posts...</p>';
        try {
            const response = await fetch(`https://graph.facebook.com/v19.0/${pageId}/posts?fields=message,full_picture,created_time,permalink_url&access_token=${pageToken}`).then(r=>r.json());
            if (response.error) throw new Error(response.error.message);
            const posts = response.data || [];
            if(posts.length === 0) {
                fbPostsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center p-8">No posts found.</p>';
                return;
            }
            fbPostsContainer.innerHTML = '';
            posts.forEach(post => {
                 const postDiv = document.createElement('div');
                 postDiv.className = 'p-3 border dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900';
                 postDiv.innerHTML = `${post.full_picture ? `<img src="${post.full_picture}" class="w-full rounded-md mb-2 max-h-48 object-cover">` : ''}<p class="text-sm max-h-24 overflow-y-auto">${post.message || '<i>No message content</i>'}</p><div class="text-xs text-gray-500 mt-2 flex justify-between items-center pt-2 border-t dark:border-gray-600"><span>${new Date(post.created_time).toLocaleDateString()}</span><a href="${post.permalink_url}" target="_blank" class="text-blue-500 hover:underline">View Post</a></div>`;
                 fbPostsContainer.appendChild(postDiv);
            });
        } catch(error) {
             fbPostsContainer.innerHTML = `<p class="text-red-500 col-span-full text-center p-8">Error: ${error.message}</p>`;
        }
    }
    
    // --- Power Editor Functions ---
    function renderPowerEditor() {
        fbCanvasPageSelector.innerHTML = '<option>Select a Page</option>';
        fbData.pages.forEach(page => {
            fbCanvasPageSelector.innerHTML += `<option value="${page.id}|${page.access_token}">${page.name}</option>`;
        });
        fbCanvasElementsContainer.innerHTML = '';
        fbAddCanvasElementBtn.dispatchEvent(new Event('click')); // Add the first element
        fbPublishCanvasBtn.disabled = false;
    }

    function addCanvasElement() {
        const element = document.createElement('div');
        element.className = 'canvas-element border dark:border-gray-700 p-3 rounded-md space-y-2';
        element.innerHTML = `
            <select class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md canvas-element-type">
                <option value="photo">Image</option>
                <option value="text">Text Block</option>
                <option value="button">Button</option>
            </select>
            <div class="canvas-element-fields">
                 <input type="text" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Image URL">
            </div>
        `;
        element.querySelector('.canvas-element-type').addEventListener('change', (e) => {
            const fieldsContainer = element.querySelector('.canvas-element-fields');
            switch(e.target.value) {
                case 'photo':
                    fieldsContainer.innerHTML = '<input type="text" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Image URL">';
                    break;
                case 'text':
                    fieldsContainer.innerHTML = '<textarea class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" rows="3" placeholder="Enter text content..."></textarea>';
                    break;
                case 'button':
                    fieldsContainer.innerHTML = '<input type="text" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md mb-2" placeholder="Button Text"><input type="text" class="w-full p-2 border bg-gray-50 dark:bg-gray-700 rounded-md" placeholder="Destination URL">';
                    break;
            }
        });
        fbCanvasElementsContainer.appendChild(element);
    }
    fbAddCanvasElementBtn.addEventListener('click', addCanvasElement);

    async function publishCanvas() {
       alert("Publishing Instant Experiences via the API is highly complex and not suitable for this client-side tool. This is a conceptual demonstration.");
    }
    fbPublishCanvasBtn.addEventListener('click', publishCanvas);
    }); // End of DOMContentLoaded
  </script>

</body>
</html>